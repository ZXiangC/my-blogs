-- Result

F_CASH_NOSTD_ASSETBAL

> 此处存疑：旧版本 资产余额应该为 0 ,但是不为  0 。所有临时处理。

```sql
------------------------------------------------------------------------- new 
-- Result
CASE WHEN  V_GXHCS='GTXT' THEN 0  
      ELSE CASE WHEN FATA.C_BUSICODE_AM <> '-1' AND PM.L_ISCASH = 1 THEN DECODE(FATA.C_SPLITLOGIC,'01',AM.F_PACTBAL,'02',AM.F_PACTBAL,AM.F_FAASSET) 
            ELSE NULL 
      END 
END F_CASH_NOSTD_ASSETBAL,--其中：非标投资_资产余额

-- 临时修改
CASE WHEN FATA.C_BUSICODE_AM <> '-1' AND PM.L_ISCASH = 1 THEN DECODE(FATA.C_SPLITLOGIC,'01',AM.F_PACTBAL,'02',AM.F_PACTBAL,AM.F_FAASSET) 
     ELSE NULL 
END F_CASH_NOSTD_ASSETBAL,--其中：非标投资_资产余额

-- AM 
select 
C.F_PACTBAL,                             --合同余额          
--信托资金投入各类项目建设分类情况-BEG--
CASE WHEN A.C_INVESTTYPE LIKE '101%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_PTQYRZ,--一般公司类企业融资
CASE WHEN A.C_INVESTTYPE LIKE '102%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_JTJCSS,--交通基础设施
CASE WHEN A.C_INVESTTYPE LIKE '103%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_SZJCSS,--市政基础设施
CASE WHEN A.C_INVESTTYPE LIKE '104%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_SLJNCJCSS,--水利及农村基础设施
CASE WHEN A.C_INVESTTYPE LIKE '105%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_HJBFSS,--环境保护设施
CASE WHEN A.C_INVESTTYPE LIKE '106%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_SHSY,--社会事业
CASE WHEN A.C_INVESTTYPE LIKE '107%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_YQ,--园区
CASE WHEN A.C_INVESTTYPE LIKE '108%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_TDCBZX,--土地储备中心
CASE WHEN A.C_INVESTTYPE LIKE '109%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_BZXAJGC,--保障性安居工程
CASE WHEN A.C_INVESTTYPE LIKE '110%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_QT,--其他（信政类项目分类）
CASE WHEN A.C_INVESTTYPE LIKE '201%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_FXZFDC_ZZ,--住宅
CASE WHEN A.C_INVESTTYPE LIKE '202%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_FXZFDC_SY,--商用
CASE WHEN A.C_INVESTTYPE LIKE '203%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_FXZFDC_JSF,--经适房
CASE WHEN A.C_INVESTTYPE LIKE '204%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_FXZFDC_TDCB,--土地储备
CASE WHEN A.C_INVESTTYPE LIKE '205%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_FXZFDC_QT,--其他 （房地产项目分类（非信政类））
CASE WHEN A.C_INVESTTYPE LIKE '3%'   THEN C.F_PACTBAL  ELSE 0 END F_XMQK_KCNY,--矿产能源
CASE WHEN A.C_INVESTTYPE LIKE '4%'   THEN C.F_PACTBAL  ELSE 0 END F_XMQK_QT--其他
FROM HSTDC.AM_PACT A,HSTDC.AM_PACTASSET B,
(select O.C_PACTID C_STOCK_CODE, SUM(NVL(O.F_DLVCAPITAL,0) *(O.L_STOCKDIR) ) F_PACTBAL --SUM(NVL(O.F_DLVCAPITAL,0) *(- O.L_FUNDDIR) ) F_PACTBAL
from HSTDC.AM_ORDER O
WHERE O.L_STOCKDIR <> '3' --排除资产方向为 3-置数
  AND O.C_STATUS IN ('8','9')
  -- AND O.C_ORDERID like '1100%' -- 国通加上后一条合同都没有 暂时去掉。
--   AND O.L_FUNDDIR IN ('-1','1')
  AND O.D_DELIVERY <= date '2020-12-31' GROUP BY O.C_PACTID
  ) C  ---剩余本金
  WHERE A.C_PACTID = C.C_STOCK_CODE
    AND A.C_PACTID = B.C_PACTID(+)
    AND A.L_STATE NOT IN('3','4') AND C.F_PACTBAL > 0
		and A.C_PACTID = 'GQ51700G';
		
--select t.c_pactid, t.* from hstdc.am_pact t where t.c_projcode ='HB27';		
-------------------------------------------------------------------- old
-- Result
CASE WHEN  V_GXHCS='GTXT' THEN 0  
     ELSE CASE WHEN FATA.C_BUSICODE_AM <> '-1' AND PM.L_ISCASH = 1 THEN DECODE(FATA.C_SPLITLOGIC,'01',AM.F_PACTBAL,'02',AM.F_PACTBAL,AM.F_FAASSET) 
          ELSE NULL 
     END 
END F_CASH_NOSTD_ASSETBAL,--其中：非标投资_资产余额

-- Result
select 
C.F_PACTBAL,                             --合同余额             
CASE WHEN A.C_INVEST_TYPE LIKE '101%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_PTQYRZ,--一般公司类企业融资
CASE WHEN A.C_INVEST_TYPE LIKE '102%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_JTJCSS,--交通基础设施
CASE WHEN A.C_INVEST_TYPE LIKE '103%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_SZJCSS,--市政基础设施
CASE WHEN A.C_INVEST_TYPE LIKE '104%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_SLJNCJCSS,--水利及农村基础设施
CASE WHEN A.C_INVEST_TYPE LIKE '105%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_HJBFSS,--环境保护设施
CASE WHEN A.C_INVEST_TYPE LIKE '106%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_SHSY,--社会事业
CASE WHEN A.C_INVEST_TYPE LIKE '107%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_YQ,--园区
CASE WHEN A.C_INVEST_TYPE LIKE '108%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_TDCBZX,--土地储备中心
CASE WHEN A.C_INVEST_TYPE LIKE '109%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_BZXAJGC,--保障性安居工程
CASE WHEN A.C_INVEST_TYPE LIKE '110%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_XZ_QT,--其他（信政类项目分类）
CASE WHEN A.C_INVEST_TYPE LIKE '201%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_FXZFDC_ZZ,--住宅
CASE WHEN A.C_INVEST_TYPE LIKE '202%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_FXZFDC_SY,--商用
CASE WHEN A.C_INVEST_TYPE LIKE '203%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_FXZFDC_JSF,--经适房
CASE WHEN A.C_INVEST_TYPE LIKE '204%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_FXZFDC_TDCB,--土地储备
CASE WHEN A.C_INVEST_TYPE LIKE '205%' THEN C.F_PACTBAL  ELSE 0 END F_XMQK_FXZFDC_QT,--其他 （房地产项目分类（非信政类））
CASE WHEN A.C_INVEST_TYPE LIKE '3%'   THEN C.F_PACTBAL  ELSE 0 END F_XMQK_KCNY,--矿产能源
CASE WHEN A.C_INVEST_TYPE LIKE '4%'   THEN C.F_PACTBAL  ELSE 0 END F_XMQK_QT--其他
FROM TI_HSAM_IFPACT@ttf_old A,
    ( SELECT C_STOCK_CODE,SUM(F_UNTRANSFERED_INVEST) F_PACTBAL FROM TI_HSAM_TRADBPOSN@ttf_old
      WHERE L_TRADE_DATE = (SELECT MAX(L_TRADE_DATE) FROM TI_HSAM_TRADBPOSN@ttf_old WHERE L_TRADE_DATE <= TO_NUMBER(TO_CHAR(date'2020-12-31','YYYYMMDD')) )
      GROUP BY C_STOCK_CODE
      ) C  ---持仓
WHERE A.C_STOCK_CODE = C.C_STOCK_CODE 
  AND A.C_STOCK_STATUS IN('1','2') AND C.F_PACTBAL > 0
	and A.C_STOCK_CODE = 'GQ51700G'
```

