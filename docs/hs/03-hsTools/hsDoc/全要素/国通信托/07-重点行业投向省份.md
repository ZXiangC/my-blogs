#### 重点行业投向省份

```sql

---------------------------------------------------- new 
-- Result
CASE WHEN (V_PINDUSTRYDTL = 0 OR V_PINDUSTRYDTL = 2) AND SUBSTR(AM.C_PINDUSTRYDTL,1,1) IN('B','K') THEN AM.C_PROVINCENAME
     WHEN V_PINDUSTRYDTL = 1 AND SUBSTR(PM.C_INDUSTRYDTL1,1,1) IN('B','K') THEN AM.C_PROVINCENAME
      ELSE NULL 
END C_AREANAME_KEY, --重点行业投向地区：B-采掘业、K-房地产投向地区(XX省XX市，省市合并)

-- Am
CASE WHEN NVL(R.C_SOURCENO,'HSAM') <> 'HSAM' THEN--非资管字典
            --省市合并
            ( SELECT TD.C_DICT_NAME C_AREANAME FROM TSYS_DICT_TREE TD
              WHERE TD.C_DICT_ENTRY_CODE = 'T0002' AND TD.C_LEVEL = 1 AND SUBSTR(TD.C_DICT_ITEM_CODE,1,2) = SUBSTR(P.C_AREACODE,1,2)||'0000'
              )||( SELECT TD.C_DICT_NAME C_AREANAME  FROM TSYS_DICT_TREE TD
                  WHERE TD.C_DICT_ENTRY_CODE = 'T0002' AND TD.C_LEVEL = 2 AND SUBSTR(TD.C_DICT_ITEM_CODE,1,4) = SUBSTR(P.C_AREACODE,1,4)||'00'
                    )
      ELSE
        ( SELECT TD.C_DICT_NAME C_AREANAME FROM TSYS_DICT_TREE TD
          WHERE TD.C_DICT_ENTRY_CODE = 'T0002' AND TD.C_LEVEL = 1 AND TD.C_DICT_ITEM_CODE = SUBSTR(P.C_AREACODE,1,2)||'0000'
          )||( SELECT TD.C_DICT_NAME C_AREANAME  FROM TSYS_DICT_TREE TD
              WHERE TD.C_DICT_ENTRY_CODE = 'T0002' AND TD.C_LEVEL = 2 AND TD.C_DICT_ITEM_CODE = SUBSTR(P.C_AREACODE,1,4)||'00'
                )
END C_PROVINCENAME, --重点行业投向地区

----------------------------------------------------  old
-- Result
CASE WHEN (V_PINDUSTRYDTL = 0 OR V_PINDUSTRYDTL = 2) AND SUBSTR(AM.C_PINDUSTRYDTL,1,1) IN('B','K') THEN AM.C_PROVINCENAME
     WHEN V_PINDUSTRYDTL = 1 AND SUBSTR(PM.C_INDUSTRYDTL1,1,1) IN('B','K') THEN AM.C_PROVINCENAME
    ELSE NULL 
END C_AREANAME_KEY, --重点行业投向地区：B-采掘业、K-房地产投向地区(XX省XX市，省市合并)

-- AM
CASE WHEN NVL(R.C_SOURCE,'HSAM') <> 'HSAM' THEN--非资管字典
               --省市合并
          ( SELECT TD.C_CAPTION C_AREANAME  FROM hsstg.v_ts2bd_treedict TD
            WHERE TD.C_KEYNO = 'T0002' AND TD.L_LEVEL = 2
            AND TD.C_CODE = SUBSTR(P.C_AREACODE,1,4) AND TD.C_SOURCENO = 'AIM'
            )
      ELSE
        ( SELECT TD.C_DESC C_AREANAME FROM TI_HSAM_DICT TD
          WHERE TD.C_KEY = 'T0002' AND TD.L_LEVEL = 1 AND TD.C_VALUE = SUBSTR(P.C_AREACODE,1,2)
          )||( SELECT TD.C_DESC C_AREANAME  FROM TI_HSAM_DICT TD
              WHERE TD.C_KEY = 'T0002' AND TD.L_LEVEL = 2 AND TD.C_VALUE = SUBSTR(P.C_AREACODE,1,4)
                )
END C_PROVINCENAME,--重点行业投向地区
```

